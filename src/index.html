<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="login.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PassKeeper</title>
    <!--script type="module" src="main.js" defer></script-->
  </head>
  <body>
    <div class="login-box">
      <h2>ğŸ” ë¡œê·¸ì¸</h2>
      <form id="loginForm" autocomplete="off">
        <input type="text" id="username" placeholder="ì•„ì´ë””" required>
        <input type="password" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸" required>
        <button type="submit">ë¡œê·¸ì¸</button>
        <div id="errorMsg" class="error"></div>
      </form>
      <span class="create-link" id="showCreateAccount">ê³„ì • ìƒì„±</span>
    </div>
    <!-- ê³„ì • ìƒì„± ëª¨ë‹¬(ë ˆì´ì–´) -->
    <div class="modal-backdrop" id="modalBackdrop">
      <div class="modal-content">
        <h3>ê³„ì • ìƒì„±</h3>
        <form id="createForm" autocomplete="off">
          <input type="text" id="newUsername" class="modal-input" placeholder="ì•„ì´ë””" required>
          <input type="password" id="newPassword" class="modal-input" placeholder="ë¹„ë°€ë²ˆí˜¸" required>
          <input type="password" id="confirmPassword" class="modal-input" placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸" required>
          <div class="modal-error" id="createErrorMsg"></div>
          <div class="modal-btn-row">
            <button type="submit">ì €ì¥</button>
            <button type="button" id="cancelCreateBtn" style="background:#e5e7eb;color:#222;">ì·¨ì†Œ</button>
          </div>
        </form>
      </div>
    </div>
    <!--script type="module" src="https://unpkg.com/@tauri-apps/api@2/dist/index.min.js"></script-->
    <script src="main.js" defer></script>
    <script>
      const loginForm = document.getElementById("loginForm");
      const errorMsg = document.getElementById("errorMsg");

      loginForm.onsubmit = (e) => {
        e.preventDefault();
        const username = document.getElementById("username").value;
        const password = document.getElementById("password").value;
        login(username, password).then(isValid => {
          if (isValid) {
            errorMsg.innerText = "";
            window.location.href = "keeper.html";
          } else {
            errorMsg.innerText = "ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.";
          }
        });
      };
      
      // ê³„ì • ìƒì„± ë ˆì´ì–´ ê´€ë ¨
      const showCreateBtn = document.getElementById("showCreateAccount");
      const modalBackdrop = document.getElementById("modalBackdrop");
      const cancelCreateBtn = document.getElementById("cancelCreateBtn");
      const createForm = document.getElementById("createForm");
      const createErrorMsg = document.getElementById("createErrorMsg");

      // ëª¨ë‹¬ ì—´ê¸°
      showCreateBtn.onclick = () => {
        createForm.reset();
        createErrorMsg.innerText = "";
        modalBackdrop.classList.add("active");
        document.getElementById("newUsername").focus();
      };
      // ëª¨ë‹¬ ë‹«ê¸° í•¨ìˆ˜
      function closeCreateLayer() {
        modalBackdrop.classList.remove("active");
        createErrorMsg.innerText = "";
      }
      cancelCreateBtn.onclick = closeCreateLayer;
      // backdrop í´ë¦­ ì‹œ ë‹«ê¸°
      modalBackdrop.onclick = (e) => {
        if (e.target === modalBackdrop) closeCreateLayer();
      };

      // ê³„ì •ìƒì„± ìœ íš¨ì„±/ì²˜ë¦¬
      createForm.onsubmit = (e) => {
        e.preventDefault();
        const id = document.getElementById("newUsername").value.trim();
        const pw = document.getElementById("newPassword").value;
        const pw2 = document.getElementById("confirmPassword").value;
        if (!id) {
          createErrorMsg.innerText = "ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”.";
          return;
        }
        if (!pw) {
          createErrorMsg.innerText = "ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.";
          return;
        }
        if (pw !== pw2) {
          createErrorMsg.innerText = "ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.";
          return;
        }
        
        createAccount(id, pw).then(() => {
          createErrorMsg.innerText = "ê³„ì •ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!";
          setTimeout(() => {
            closeCreateLayer();
          }, 1000);
        });
      };
    </script>
  </body>
</html>